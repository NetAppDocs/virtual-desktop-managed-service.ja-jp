---
sidebar: sidebar 
permalink: images.updateimages.html 
summary: VDM で VM イメージを更新および展開する 
keywords:  
---
= VM イメージを更新して導入
:toc: macro
:hardbreaks:
:toclevels: 2
:toc: 
:toclevels: 2
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/
:keywords: 
:toc-position: content




== アプリケーション配信の方法論

ユーザーは、セッションホスト仮想マシン（ SHVM ）がインストールされているどのアプリケーションにもアクセスできます。このマシンは、ユーザーセッションが実行されている場所です。

ユーザは、ユーザグループのメンバーシップに基づいて SHVM のプール（「ホストプール」）に割り当てられます。ホストプール内のすべての SHVM は、同じ VM イメージに基づいており、同じアプリケーションを持ち、同じ VM リソース上で実行されます。ユーザが接続するたびに、ホストプール内の SHVM に割り当てられ、現在のユーザセッションは最も少なくなります。

ホストプール内の各 SHVM に対してアプリケーションを追加または削除することにより、 VDM 管理者は、 VDM ユーザーがアクセスできるアプリケーションを制御できます。

各 SHVM からのアプリケーションの追加（または削除）は、各 SHVM で直接実行することも、 1 つの VM イメージに対して実行することもできます。このイメージは、ホストプール内のすべての SHVM に展開できます。

この記事では、 VM イメージの管理について説明します。SHVM にアプリケーションを直接インストールする方法については、を参照してください link:applications.installapplications.html["この記事では"]。



=== VM イメージを更新しています

SHVM にアプリケーションを追加（または削除）するための推奨方法は、ホストプールに割り当てられた VM イメージを編集することです。VM イメージをカスタマイズして検証すると、 VDM サポートチームは要求に応じて、ホストプール内のすべての SHVM に VM イメージを導入できます。

.VM イメージを編集する方法
. VDS ポータルで、導入環境内の「 Provisioning Collections 」に移動します
. 更新するホストプールに関連付けられているプロビジョニングコレクションをクリックします。
+
[role="thumb"]
image:applications.addtoapplibrary-fdcc3.png["900,900"]

+
.. 「サーバ」セクションの「 VM テンプレート」の名前をメモします。
+
[role="thumb"]
image:applications.deployapps-0e39c.png["900,900"]

+
[role="thumb"]
image:applications.deployapps-c642c.png["900,900"]



. サーバテンプレートを編集して、手順 2.a でメモした VM テンプレートがソーステンプレートであることを確認します上。[ 続行 ] をクリックします。
+
[role="thumb"]
image:applications.deployapps-307cb.png[""]




NOTE: * これらの設定は編集しないでください： * 1 。タイプ = VDI 2 。共有ドライブ = 空 3.最小キャッシュ = 0 4データドライブ = チェックマークが付いていません。 5.ストレージタイプ = Standard_LRS

. VDM の自動化により、 Azure で一時的な VM が作成されます。マシン名は _CWT#_ になります。この VM の構築には 25 分かかることがあります。処理が完了すると、ステータスは「保留中」に変わります。
+
.. 注：この VM はカスタマイズプロセスが完了するまで実行されるため、 1 日または 2 日以内に VM を構築、カスタマイズ、検証することが重要です。


. 一時的な VM の準備ができたら、 Provisioning Collection を編集してから、サーバ上の [Connect] をクリックして、 VM にログオンできます。
+
.. クレデンシャルの入力を求められたら、「 PAM Approver 」権限を持つ VDM 管理者がドメイン管理者のクレデンシャルを生成できます。




.更新された VM イメージを導入する方法
. VM イメージが検証されたら、 VDM サポートチームに連絡して、イメージの更新をスケジュールします。
. チームは、新しいイメージに基づいて新しいセッションホストを構築します。
+
.. 必要に応じて、新しいユーザを新しいホストにリダイレクトする前に、新しいホストのテストにかかる時間を調整してください。


. 準備ができたら、サポートチームはすべての新しいユーザセッションを新しいホストにリダイレクトします。ユーザが接続されていない場合は、古いホストをシャットダウンします。これらの古い VM は、ウォームフェイルオーバー用に割り当て解除状態のままになりますが、これらの VM は 7 日後に自動的にパージされます。




=== SHVM を直接変更する

SHVM に直接変更を加えることも、利用可能な自動化ツールを使用して変更することもできます。詳細については、を参照してください link:applications.installapplications.html["この記事では"]。

ホストプール内の SHVM に直接変更を加える場合は、各 SHVM を同じように設定し続けるか、異なる SHVM に接続するときに一貫性のないエクスペリエンスを持たせておくことが重要です。


WARNING: デフォルトでは、個々の SHVM は固有のデータを持たず、標準化された VM イメージに基づいているため、バックアップされません。SHVM に直接カスタマイズする場合は、サポートに連絡して、ホストプール内の SHVM のいずれかに適用されるバックアップポリシーを取得してください。



=== Sysprep のトラブルシューティング

VDM イメージの「検証」機能では、 Microsoft の Sysprep ユーティリティを使用します。検証が失敗した場合、最も一般的な原因は Sysprep エラーです。問題のトラブルシューティングを行うには、 CWT# VM のパス C ： \Windows\system32\Sysprep \Panther\setupact.log にある Sysprep ログファイルから開始します
